
DROP SCHEMA IF EXISTS biblioteca;
CREATE SCHEMA IF NOT EXISTS biblioteca;
USE biblioteca ;

CREATE TABLE IF NOT EXISTS biblioteca.aluno (
  id INT NOT NULL AUTO_INCREMENT,
  nome VARCHAR(100) NOT NULL,
  cpf VARCHAR(11) NOT NULL,
  telefone VARCHAR(11) NOT NULL,
  email VARCHAR(50) NULL DEFAULT NULL,
  cep VARCHAR(8) NOT NULL,
  estado VARCHAR(45) NOT NULL,
  cidade VARCHAR(45) NOT NULL,
  endereco VARCHAR(100) NOT NULL,
  bairro VARCHAR(45) NOT NULL,
  PRIMARY KEY (id));

CREATE TABLE IF NOT EXISTS biblioteca.autor (
  id INT NOT NULL AUTO_INCREMENT,
  autor VARCHAR(100) NOT NULL,
  pseudonimo VARCHAR(45) NULL DEFAULT NULL,
  nacionalidade VARCHAR(45) NULL DEFAULT NULL,
  endereco_web VARCHAR(255) NULL DEFAULT NULL,
  email VARCHAR(50) NULL DEFAULT NULL,
  telefone VARCHAR(14) NULL DEFAULT NULL,
  PRIMARY KEY (id));

CREATE TABLE IF NOT EXISTS biblioteca.categoria (
  id INT NOT NULL AUTO_INCREMENT,
  categoria VARCHAR(50) NOT NULL,
  descricao VARCHAR(200) NULL DEFAULT NULL,
  PRIMARY KEY (id))
;

CREATE TABLE IF NOT EXISTS biblioteca.editora (
  id INT NOT NULL AUTO_INCREMENT,
  editora VARCHAR(45) NOT NULL,
  cnpj VARCHAR(45) NOT NULL,
  email VARCHAR(45) NOT NULL,
  telefone VARCHAR(14) NOT NULL,
  cep VARCHAR(45) NULL DEFAULT NULL,
  estado VARCHAR(20) NULL DEFAULT NULL,
  cidade VARCHAR(45) NULL DEFAULT NULL,
  bairro VARCHAR(45) NULL DEFAULT NULL,
  endereco VARCHAR(100) NULL DEFAULT NULL,
  nacionalidade VARCHAR(45) NULL DEFAULT NULL,
  endereco_web VARCHAR(100) NULL DEFAULT NULL,
  PRIMARY KEY (id));

CREATE TABLE IF NOT EXISTS biblioteca.usuario (
  id INT NOT NULL AUTO_INCREMENT,
  nome VARCHAR(100) NOT NULL,
  usuario VARCHAR(100) NOT NULL,
  senha VARCHAR(100) NOT NULL,
  PRIMARY KEY (id));

CREATE TABLE IF NOT EXISTS biblioteca.emprestimo (
  id INT NOT NULL AUTO_INCREMENT,
  id_usuario INT NOT NULL,
  id_aluno INT NOT NULL,
  data_emprestimo DATE NOT NULL,
  data_devolucao_prevista DATE NOT NULL,
  PRIMARY KEY (id),
  INDEX fk_emprestimo_aluno_idx (id_aluno ASC) VISIBLE,
  INDEX fk_emprestimo_usuario_idx (id_usuario ASC) VISIBLE,
  CONSTRAINT fk_emprestimo_aluno FOREIGN KEY (id_aluno) REFERENCES biblioteca.aluno (id), 
  CONSTRAINT fk_emprestimo_usuario FOREIGN KEY (id_usuario) REFERENCES biblioteca.usuario (id));

CREATE TABLE IF NOT EXISTS biblioteca.livro (
  id INT NOT NULL AUTO_INCREMENT,
  id_categoria INT NOT NULL,
  id_editora INT NOT NULL,
  titulo VARCHAR(100) NOT NULL,
  ano_publicacao INT NULL DEFAULT NULL,
  isbn VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (id),
  INDEX fk_livro_categoria_idx (id_categoria ASC) VISIBLE,
  INDEX fk_livro_editora_idx (id_editora ASC) VISIBLE,
  CONSTRAINT fk_livro_categoria FOREIGN KEY (id_categoria) REFERENCES biblioteca.categoria (id),
  CONSTRAINT fk_livro_editora FOREIGN KEY (id_editora) REFERENCES biblioteca.editora (id));

CREATE TABLE IF NOT EXISTS biblioteca.emprestimo_livro (
  id INT NOT NULL AUTO_INCREMENT,
  id_emprestimo INT NOT NULL,
  id_livro INT NOT NULL,
  data_devolucao DATE NULL DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE INDEX fk_emprestimo_livro_unique (id_emprestimo ASC, id_livro ASC) VISIBLE,
  INDEX fk_emprestimo_has_livro_livro_idx (id_livro ASC) VISIBLE,
  INDEX fk_emprestimo_has_livro_emprestimo_idx (id_emprestimo ASC) VISIBLE,
  CONSTRAINT fk_emprestimo_has_livro_emprestimo FOREIGN KEY (id_emprestimo) REFERENCES biblioteca.emprestimo (id),
  CONSTRAINT fk_emprestimo_has_livro_livro FOREIGN KEY (id_livro) REFERENCES biblioteca.livro (id));
  
CREATE TABLE IF NOT EXISTS biblioteca.livro_autor (
  id INT NOT NULL AUTO_INCREMENT,
  id_livro INT NOT NULL,
  id_autor INT NOT NULL,
  PRIMARY KEY (id),
  UNIQUE INDEX uq_livro_autor (id_livro ASC, id_autor ASC) VISIBLE,
  INDEX fk_livro_has_autor_autor_idx (id_autor ASC) VISIBLE,
  INDEX fk_livro_has_autor_livro_idx (id_livro ASC) VISIBLE,
  CONSTRAINT fk_livro_has_autor_autor FOREIGN KEY (id_autor) REFERENCES biblioteca.autor (id), 
  CONSTRAINT fk_livro_has_autor_livro FOREIGN KEY (id_livro) REFERENCES biblioteca.livro (id));

CREATE TABLE IF NOT EXISTS biblioteca.multa (
  id INT NOT NULL AUTO_INCREMENT,
  id_emprestimo_livro INT NOT NULL,
  valor FLOAT NOT NULL,
  data_pagamento DATE NOT NULL,
  PRIMARY KEY (id),
  UNIQUE INDEX id_emprestimo_livro_UNIQUE (id_emprestimo_livro ASC) VISIBLE,
  INDEX fk_multa_emprestimo_idx (id_emprestimo_livro ASC) VISIBLE,
  INDEX idx_id_emprestimo_livro (id_emprestimo_livro ASC) VISIBLE,
  CONSTRAINT fk_multa_emprestimo_livro FOREIGN KEY (id_emprestimo_livro) REFERENCES biblioteca.emprestimo_livro (id));

CREATE TABLE IF NOT EXISTS biblioteca.parametro (
  id INT NOT NULL AUTO_INCREMENT,
  parametro TINYTEXT NOT NULL,
  valor FLOAT NOT NULL,
  PRIMARY KEY (id));